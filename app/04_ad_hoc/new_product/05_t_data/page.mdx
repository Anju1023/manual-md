{/* 05_t_data */}
import { Callout, Steps } from 'nextra/components'

# Step 5: 納品データの登録

売上管理および納品書発行システムである `T納品データ.xlsm` に新商品のマスタ情報を登録します。
`CB商品データ` とは自動連携していないため、**手動での登録作業** が必要となります。

## 📂 対象ファイル

<Callout type="info" emoji="📄">
	**T納品データ.xlsm** 
    
    * **場所:** `デスクトップ` > `よく使う` > `伝票作成`
	フォルダ内

</Callout>

## 📋 登録手順

<Steps>
### ファイルを開く
`T納品データ.xlsm` を開き、編集可能な状態にします。

### 商品マスタへの追加

画面下部のタブから **「T 商品マスター」** シートを選択します。
表の一番下の空行に、以下の情報を入力します。

| 項目        | 入力内容                             |
| :---------- | :----------------------------------- |
| **商品 ID** | Step 4 で発行された ID (例: `S0123`) |
| **商品名**  | 商品の正式名称                       |

### 価格履歴への追加

続いて **「T 価格履歴」** シートを選択します。
同様に表の一番下の空行に、価格情報を登録します。

※納品先（ローゼン、クリエイト等）ごとに登録が必要な場合があります。

| 項目           | 入力内容       | 注意点                               |
| :------------- | :------------- | :----------------------------------- |
| **商品 ID**    | 商品 ID        |                                      |
| **社名**       | 納品先企業名   | 正確に入力してください               |
| **適用開始日** | 新商品の発売日 | **この日付より前には集計されません** |
| **単価**       | 納品単価       | 税抜価格                             |

<Callout type="warning" emoji="⚠️">
	**入力漏れに注意** この登録を忘れると、以下のトラブルが発生します。 
    
    
    * 納品書（PDF）に商品名が表示されない 
    * 売上金額が 0円 で計算される

    必ず`CB商品データ` の登録とセットで行ってください。

</Callout>

### 保存

入力が完了したら、上書き保存してファイルを閉じます。

</Steps>

---

## 🔧 管理者向け情報 (System Specs)

### データベース構造について

本システムでは、納品日時点での単価を正確に参照するため、単純なマスタではなく「履歴テーブル (`T価格履歴`)」を持っています。

- **参照ロジック:** `GetPriceByCompany` 関数を使用
- **条件:** `商品ID` かつ `社名` が一致し、かつ `納品日` が `適用開始日` 以降であるデータの中で、最も新しい `適用開始日` の単価を取得します。

### トラブルシューティング

- **症状:** 納品書等の金額が空欄、または 0 円になる。
- **原因:** `T価格履歴` にデータがない、または「適用開始日」が納品日よりも未来の日付になっている可能性があります。
