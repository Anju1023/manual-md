import { Callout, Steps } from 'nextra/components';

# Step 7: 伝票用シートの行追加・調整

`CB商品データ.xlsm` の印刷用シート (`伝票用` 等) に、新商品の行を追加します。
本シートは高度な数式 (SPILL 機能) を使用しているため、**編集手順と編集禁止領域** を厳守してください。

## 📂 対象シート

以下の 2 つのシートで同様の作業を行います。

1. **伝票用** シート
2. **クリエ伝票用** シート

## 📋 手順

<Steps>
### 行の挿入と順序変更
通常商品リストの末尾に行を追加します。

1. **通常商品の「最下行」** の行番号を選択し、**「挿入」** を行います。
2. 挿入によってズレた **「元・最下行の商品」** を、**Shift キーを押しながら上にドラッグ** して順序を入れ替えます。
   - ※これにより、リストの一番下に空行が作成されます。

### 商品情報の入力

作成した空行に、新商品の情報を入力します。

1. **商品名:** 手入力します。
2. **売価:** 手入力します。

<Callout type="success" emoji="ℹ️">
	**自動表示機能について**
	A列に「商品名」を入力すると、E列以降（店舗ごとの数量）には数式が反応し、**自動的にデータが表示されます**。
	（手動での数式コピーは不要です）
</Callout>

### D 列 (個数計) の数式コピー

E 列以降は自動ですが、**D 列の合計** は手動でのコピーが必要です。

1. **一つ上の行の D 列 (個数計)** を選択します。
2. セルの右下（フィルハンドル）をドラッグし、**新商品の行まで数式をコピー** します。

<Callout type="error" emoji="🚫">
	**【重要】編集禁止領域** **E列以降のセル**
	には、スピル配列数式が入っています。
	この範囲にデータを入力したり、数式を貼り付けたりすると `#SPILL!`
	エラーが発生し、表全体が表示されなくなります。
	**E列以降は絶対に編集しないでください。**
</Callout>

### 印刷範囲の確認

1. **「改ページプレビュー」** に切り替えます。
2. 新商品および **合計行** が、青い太線（印刷範囲）内に収まっているか確認します。
   - 必要に応じて改ページ位置を調整してください。

### 完了

以上で登録作業は完了です。
`CB商品データ.xlsm` を **上書き保存** して終了してください。

</Steps>

---

## 🔧 管理者向け情報 (System Specs)

### 🧬 シートの構造 (SPILL と OFFSET)

本シートの E 列以降は、`E5` セルに入力された動的配列数式によって制御されています。

- **使用関数:** `IFERROR`, `LET`, `OFFSET` 等
- **動作:** A 列の商品名リスト（ヘッダーから合計行の間）を動的に参照しています。
- **仕様:** A 列に行を追加・入力することで、参照範囲が自動拡張され、E 列以降の計算結果もスピル（自動展開）されます。

### ⚠️ 運用上の注意

- **#SPILL! エラー:** E 列以降のセルに値や数式が存在すると、スピル領域が確保できずエラーとなります。エラー発生時は、該当セルのデータを削除してください。
- **D 列の仕様:** D 列 (`SUM`) のみ旧来の数式のため、オートフィルによる手動コピーが必要です。
