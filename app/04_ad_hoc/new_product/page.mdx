import { Callout, Steps } from 'nextra/components';

# 🆕 新商品登録フロー

新商品が出た時に行う一連の登録作業です。
レシピの保存からシステム登録まで、ステップ順に進めてください。

<Callout type="error" emoji="💾">
	**作業前のバックアップを忘れずに！** 編集前に、必ず `BackUp`
	フォルダへコピーを保存してください。
</Callout>

## 📋 登録手順

<Steps>
    ### レシピの保存
    作成されたレシピデータを、共有フォルダへ保存します。
    * **保存先:** `共有` > `レシピ`

    ### 本社への申請 (JAN 発行)

    新商品の JAN コードを発行してもらうため、申請書を作成して送ります。

    1. **ファイルを開く:**
    - `デスクトップ` > `新規登録` > `CB新規登録申請書.xlsx`
    2. **メール送信:**
    - 本社の **江藤さん** 宛にメールで送付してください。

    ### ラベラー (@Label) の登録

    店舗で値札シールが出せるように設定します。

    1. ラベラーソフト **@Label** を起動。
    2. JAN コード、商品名、売価を入力。
    3. **「マスタ配信」** を行って、ラベラー本体にデータを飛ばします。

    ### CB 商品データの登録 (ID 自動発行)

    `CB商品データ.xlsm` を開き、専用フォームから登録します。

    1. **ファイルを開く:**
    - `デスクトップ` > `よく使う` > `商品データ` > `CB商品データ.xlsm`
    2. **フォーム起動:**
    - メニューにある **「新規入力」** ボタンを押します。
    3. **データ入力:**
    - **カテゴリを選択すると、商品 ID が自動で採番されます！** (例: 食パン →S0123)
    - 必要な項目（商品名、売価、期限など）を入力してください。
    4. **登録:**
    - **「登録」** ボタンを押すと、一番下の行に追加されます。

    ### 納品データのマスタ登録 (手入力)

    `T納品データ.xlsm` にも新商品の情報を追加します。
    **ここは自動連携しないので、手動での入力が必要です！**

    1. **ファイルを開く:**
    - `デスクトップ` > `よく使う` > `伝票作成` > `T納品データ.xlsm`
    2. **T 商品マスター シート:**
    - 一番下の行に **商品 ID** (さっき発行されたもの) と **商品名** を入力します。
    3. **T 価格履歴 シート:**
    - **商品 ID**、**適用開始日**、**単価** を入力します。
    - ※開始日を間違えると、その日から計算されないので注意！

    ### 数量入力と印刷

    再び `CB商品データ.xlsm` に戻ります。

    1. 社長から指示された **製造予定数** を入力します。
    2. **「全店舗分出力」** (または印刷) を行い、各店ごとの製造数を確認します。

    ### 伝票用シートの調整 (仕上げ)

    最後に、印刷用のレイアウトを整えます。

    - `伝票用` シートや `クリエ伝票用` シートで行が足りない場合は、行の挿入や調整を行ってください。

</Steps>

---

## 🔧 管理者向け情報 (System Specs)

### 🤖 CB 商品データの ID 生成ロジック

ユーザーフォーム (`cmbCategory_Change`) でカテゴリを選択すると、既存の最大 ID を探して `+1` した ID を自動生成します。
このロジックがあるため、ID の重複を防ぐことができます。

| カテゴリ   | ID 接頭辞 | 例    |
| :--------- | :-------: | :---- |
| 食パン     |   **S**   | S0001 |
| バケット   |   **B**   | B0001 |
| ロール     |   **R**   | R0001 |
| 菓子パン   |   **K**   | K0001 |
| 調理パン   |   **C**   | C0001 |
| ドーナツ   |   **D**   | D0001 |
| デニッシュ |   **E**   | E0001 |

### 💻 ソースコード (Form Logic)

```vb
' カテゴリ選択時にIDを自動生成するロジック
Private Sub cmbCategory_Change()
    Dim prefix As String
    ' (中略) カテゴリに応じたPrefix設定
    Select Case cmbCategory.Value
        Case "食パン": prefix = "S"
        Case "バケット": prefix = "B"
        ' ... (その他カテゴリ)
    End Select

    ' 最大値を取得して +1 する処理
    ' ...
    txtItemID.Value = prefix & Format(maxNum + 1, "0000")
End Sub

' 登録ボタンの処理
Private Sub btn登録_Click()
    ' テーブルに行を追加してフォームの値を転記
    Set newRow = lo.ListRows.Add
    With newRow.Range
        .Cells(1, lo.ListColumns("商品ID").Index).Value = Me.txtItemID.Value
        ' ... (その他項目の転記)
    End With
    MsgBox Me.txtItemName & "を登録しました！", vbInformation
End Sub
```
