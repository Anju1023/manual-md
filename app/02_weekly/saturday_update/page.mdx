import { Callout, Steps } from 'nextra/components';

# 📅 土曜日のデータ更新 (2 週間サイクル)

毎週土曜日に実行する、データメンテナンス作業です。
本システムは「2 週間分」のデータを管理しており、更新処理によってデータを 1 週間分ずらし（ローリングし）、翌週の製造指示が出せるようにします。

## 📋 運用の仕組み

<Callout type="info" emoji="🔄">
	**2週間ローリング方式** * 土曜日の更新ボタンを押すと、現在の **「翌週分
	(右側)」** のデータがコピーされ、**「今週分 (左側)」** に上書きされます。 *
	空いた右側に、再来週分のデータを入力していく流れになります。
</Callout>

## 📋 手順

<Steps>
	### 1. 伝票用シートの確認 (月曜分まで)
	更新を行う前に、直近の製造数に変化がないか確認します。

    1. **「明後日」** ボタン等を使い、**月曜日** までの伝票用シートを表示・印刷します。
    2. **色の変化をチェック！**
    - シートには「前日分と数量が違うと色が変わる」条件付き書式が設定されています。
    - 急な変更を見落とさないよう、必ず確認してください。

    ### 2. 更新前のバックアップ (必須！)

    作業中にデータが消えるリスクに備えます。

    1. `CB商品データ.xlsm` を閉じます。
    2. ファイルをコピーし、`BackUp` フォルダへ保存します。
    - ファイル名例: `CB商品データ_更新前.xlsm`

    ### 3. 更新実行

    1. ファイルを開き、**「操作」シート** を表示します。
    2. **「更新」** ボタンを押します。
    3. 「更新作業を行います。よろしいですか？」→ **「OK」**

    <Callout type="success" emoji="🤖">
    	**何が起きているの？** * 各店舗シートの **J列〜P列 (翌週分)**
    	のデータがコピーされ、**C列 (今週分)** に値貼り付けされます。 *
    	操作シートの日付が更新されます。
    </Callout>

    ### 4. 検食 (菌検査) データの入力

    検食用のパンを確保するため、数量を調整します。
    **更新直後は右側（翌週分）のデータが残っている** ため、一度リセットしてから入力します。

    1. 各店舗シートの **翌週分 (右側)** の数量をすべて `0` にします。
    2. 以下の **固定検食** を毎日 `1` にします。
    - **プレミアム食パン 1/4**
    - **バターチキンカレーパン**
    3. **「菌検査スケジュール表 (紙)」** を確認します。
    4. 該当する日・商品の数量に `+1` していきます。

    ### 5. 数量修正の反映

    店舗や本社から依頼があった修正内容を反映させます。

    - **修正依頼:** 月曜までに届いている依頼内容を入力します。
    - **定休日対応:** お休みの店舗がある場合は `0` にします。
    - **イレギュラー対応:** 「お楽しみ袋」や「新商品」などの特注対応を入力します。

    <Callout type="warning" emoji="📝">
    	**元に戻すのを忘れずに！**
    	特売やイベントで一時的に数量を変えた場合は、イベント終了後に元の数量に戻すのを忘れないようにしてください。
    </Callout>

    ### 6. 全部まとめて出力

    修正が終わったら、全ての帳票を一括出力します。

    1. **「操作」シート** に戻ります。
    2. **「全部まとめて出力」** ボタンを押します。
    - ※ボタンひとつで、製造数合計、ラベル表、生地出し表、発注表などがすべて作成されます。

    ### 7. 更新後のバックアップ (念には念を！)

    来週の作業開始地点として、確定したデータを保存します。

    1. ファイルを上書き保存して閉じます。
    2. 再度コピーし、`BackUp` フォルダへ保存します。
    - ファイル名例: `CB商品データ_1201更新完了.xlsm`
    </Steps>

---

## 🔧 管理者向け情報 (System Specs)

### 💻 更新マクロの仕様 (`Sub 更新`)

- **処理内容:**
  - 定義されたシート (`先頭` 〜 `クリエ末尾` の間) をループ処理します。
  - `J5:P最終行` (翌週エリア) をコピーし、`C5` (今週エリア) に **値貼り付け** します。
  - A 列 5 行目以降が空欄のシートはスキップされます。

### 🏷️ マクロ名「フォーム後処理」について

コード内に `Call フォーム後処理` という記述がありますが、これは**歴史的経緯による命名**です。

- **経緯:** 以前は検食入力用のユーザーフォームが存在しましたが、「手入力の方が早い」という理由で廃止されました。
- **現在:** 単に更新完了日時 (`Now`) を記録し、完了メッセージを出すだけの処理になっています。

### 🖨️ 「全部まとめて出力」の構造

このボタンは、以下の処理を順番に呼び出すラッパーマクロです。

```vb
Sub 全部まとめて出力()
    Call 合計まとめて出力         ' CB/クリエ/全体製造数
    Call まとめてラベル出し出力     ' ローゼン/クリエ消費期限チェック
    Call 生地出し並べ表まとめて出力 ' 冷凍/スクラッチ/並べる表
    Call 発注表作成              ' 原材料発注計算
    Call 発注表_仕入先別出力      ' 発注書印刷
End Sub
```
