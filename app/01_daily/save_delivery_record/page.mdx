import { Callout, Steps } from 'nextra/components';

# 納品記録の保存

翌日納品分の売上データを確定させ、記録用の PDF ファイルを保存します。
「日替わり表の印刷」が完了した後に実施してください。

## 📂 対象ファイル

<Callout type="info" emoji="📄">
	**T納品データ.xlsm** 
    
    * **場所:** `デスクトップ` > `よく使う` > `伝票作成`フォルダ内

</Callout>

## 📋 手順

<Steps>
### ファイルを開く
`T納品データ.xlsm` を開きます。
「ホーム」シートが表示されていることを確認してください。

### 集計の実行

メニューにある **「集計」** ボタンをクリックします。
最新のデータが読み込まれ、全店舗分の納品数が計算されます。

<Callout type="info" emoji="⏳">
	**処理待ち**

    データ量により数秒〜数十秒かかります。「集計完了！」というメッセージが表示されるまで、操作を行わずに待機してください。

</Callout>

### PDF 作成・保存

続いて **「納品記録 PDF」** ボタンをクリックします。
処理中は進捗バー（プログレスバー）が表示されます。画面が動かなくなっても、処理終了までキーボードやマウスに触れないでください。

### 保存結果の確認

「書き込み&保存完了！」等のメッセージが表示されたら、以下の場所に PDF ファイルが正しく保存されているか確認します。

- **保存場所:** `デスクトップ` > `よく使う` > `伝票作成` > `納品記録` > `納品記録PDF`
- **フォルダ構成:** `[年月]` フォルダ > `[年月日]` フォルダ
  - 例: `2025-11` > `2025-11-29`
- **ファイル:** 店舗ごとの PDF ファイル (`yyyy-mm-dd_店舗名.pdf`)

### 完了

確認ができたら、ファイルを **上書き保存** して終了します。

</Steps>

---

## 🔧 管理者向け情報 (System Specs)

### 📂 保存先フォルダの自動生成

PDF 保存マクロ実行時、該当日付のフォルダが存在しない場合は自動的に作成 (`MkDir`) されます。

### 💰 単価参照ロジック (`GetPriceByCompany`)

納品書に記載される商品単価は、単純なマスタ参照ではなく、**「価格履歴テーブル」** から取得しています。

- **ロジック:** 商品 ID と会社名が一致し、かつ「適用開始日」が納品日以前であるデータの中で、最新の単価を参照します。
- **注意点:** 新商品を登録する際は、`T価格履歴` シートへの登録を忘れると単価が反映されません（0 円となります）。
  - 参照: [新商品登録フロー - 納品データの登録](/04_ad_hoc/new_product/05_t_data)
