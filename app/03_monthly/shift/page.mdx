import { Callout, Steps } from 'nextra/components';

# シフト作成・清書

翌月分のスタッフシフト表を作成・管理します。
勤怠管理に関わる重要な書類ですので、正確な操作が必要です。

## 📂 使用するファイル

<Callout type="info" emoji="📄">
	**シフト表.xlsx** 
    
    * **場所:** `デスクトップ` > `よく使う` > `シフト表.xlsx`

</Callout>

## 📋 手順 1: 用紙の準備 (入力前)

<Steps>
    ### シートの複製と更新 (自動日付設定)
    1. ファイルを開き、**今月分のシート** を複製します。
    2. シート名を **翌月の数字のみ** (例: `12` → `1`) に変更します。

    <Callout type="success" emoji="💡">
        **日付は自動で変わります！** シート名を変更すると、数式 (`CELL`関数)
        が反応して、日付列の「月」が自動的に更新されます。
        ただし、**年が変わるタイミング** だけは手動修正が必要です（後述）。
    </Callout>

    ### 日付範囲の調整 (列のコピー挿入)

    給与計算の締め日に合わせ、日付が **11 日 〜 翌月 10 日** になるように調整します。

    - **列を削除する場合:** 不要な日の列を選択し、削除します。
    - **列を増やす場合:**
    1. 隣の列を丸ごと選択して **コピー** します。
    2. そのまま右クリックし、**「コピーしたセルの挿入」** を選びます。
        - ※日付が重複します（例: 9, 9, 10...）。
    3. **日付を修正します。**
        - 正しい日付のセルを 2 つ選択し、オートフィルして書き換えてください。

    ### 年休残数の持ち越し

    1. **今月シート** の「年休残」列をコピーします。
    2. **翌月シート** の **AL5 セル** (前月残) から下に、**「値貼り付け」** します。

    ### データのクリア

    1. シフト内容をすべて削除し、空白にします。
    2. 印刷して掲示します。

</Steps>

## 📋 手順 2: シフト入力・周知 (清書)

部長から手書きのシフト表が戻ってきたら、清書を行います。

<Steps>
    ### シフトの入力
    手書きの内容を Excel に入力します。
    土日や祝日は、日付に応じて自動的に色が付きます。

    <Callout type="error" emoji="🛑">
        **「半休」の入力ルール** 半日出勤の場合は、必ず **「半休」**
        という文字を含めるか、**「AM」「PM」** と入力してください。
    </Callout>

    ### 周知 (LINE)

    1. **PDF エクスポート:** PDF 形式で保存します。
    2. **画像変換:** Web ツール等で **PNG 画像** に変換します。
    3. **LINE 送信:** グループ LINE に送信して完了です。

</Steps>

## 📅 年末年始の特別作業 (年更新 & 祝日)

<Callout type="error" emoji="🎍">
	**12月〜1月はここをチェック！**
	年が変わるタイミングでは、以下の2箇所を必ず修正してください。 これを忘れると
	**「曜日がズレる」「祝日が赤くならない」** という重大なミスに繋がります。
</Callout>

### 1. 「年」の手動更新 (1 月シート作成時)

シート名を変えても「月」しか変わりません。「年」は手入力が必要です。

1. 新しい年のシート（シート名 `1`）を作成します。
2. 左上の **B1 セル (年)** を確認します。
3. ここを **新しい西暦 (例: 2026)** に手入力で書き換えてください。
   - ※書き換えないと、日付は自動計算されますが、曜日が 1 年前のままになります。

### 2. 祝日リストの更新 (2 年分)

祝日リストは常に最新の 2 年分で運用します。

1. **リストの更新:**
   - 「祝日リスト」シートを開きます。
   - 古い年のデータを削除し、**「今年」と「来年」の 2 年分** になるようにデータを入れ替えます。
2. **条件付き書式の修正:**
   - シフト表のシートに戻り、日付の行を選択します。
   - 「条件付き書式」→「ルールの管理」を開きます。
   - 赤色になるルールの数式 `=COUNTIF(祝日リスト!$B$3:$B$100, ...)` を編集します。
   - `$100` の部分を、もしデータが増えていたらデータが増えた行数に合わせて広げます。

---

## 🔧 管理者向け情報 (System Specs)

### 📆 日付自動表示の仕組み

このシートは、シート名から「月」を取得する高度な数式を使用しています。

- **月取得:** `=RIGHT(CELL("filename",A1),LEN(CELL("filename",A1))-FIND("]",CELL("filename",A1)))`
  - ※シート名「11」などの数字を取得しています。
- **日付計算:** `=DATE($B$1, $D$1-1, 11)`
  - `$B$1` (年) と `$D$1` (取得した月) を組み合わせて開始日を計算しています。
  - **注意:** `$B$1` は数式ではないため、年越し時に手動更新が必要です。

### 🎨 色分けの仕組み

- **土日:** `WEEKDAY` 関数。
- **祝日:** `COUNTIF(祝日リスト, 日付)=1`。
  - 参照範囲が固定のため、リスト更新時は範囲修正が必要です。
